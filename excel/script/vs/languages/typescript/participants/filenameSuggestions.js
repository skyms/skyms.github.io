/*---------------------------------------------------------
 * Copyright (C) Microsoft Corporation. All rights reserved.
 *--------------------------------------------------------*/
"use strict";define("vs/languages/typescript/participants/filenameSuggestions",["require","exports","vs/base/strings","vs/base/paths","vs/base/collections","vs/base/lib/winjs.base","vs/base/network","vs/languages/typescript/lib/typescriptServices","vs/languages/typescript/project/typescriptProject"],function(e,t,n,r,o,i,s,a,l){var c=function(){function e(e,t,n){this._requestService=e,this._amd=t,this.basepath=n,"/"===this.basepath&&(this.basepath=null)}return e.prototype.makeModulePath=function(e,t,n){return e?this._toRequirePath(t,n):this._toReferencesPath(t,n)},e.prototype._toRequirePath=function(e,t){var o,i=r.dirname(t);if(this._amd&&this.basepath){var a=this._requestService.getPath("root",s.URL.fromValue(e));o=a.substr(this.basepath.length),o=n.ltrim(o,"/")}else o=r.join(r.relative(i,r.dirname(e)),r.basename(e)),n.startsWith(o,"..")||(o="./"+o);return o=n.rtrim(o,".ts"),o=n.rtrim(o,".js")},e.prototype._toReferencesPath=function(e,t){var n=r.dirname(t);return r.join(r.relative(n,r.dirname(e)),r.basename(e))},e}();t.PathMaker=c;var u=function(){function e(e){this._resourceServices=e.resourceService,this._requestService=e.requestService}return e.prototype.suggest=function(e,t,s){if(!(s&&s.syntaxTree&&s.project instanceof l.TypeScriptProject))return i.TPromise.as(null);var a=s.syntaxTree,u=this._findCurrentWord(e,t,a);if(!u)return i.TPromise.as(null);var d=s.project,p=d.compileConfiguration(),h=new c(this._requestService,n.equalsIgnoreCase(p.module,"amd"),p.baseUrl),m=e.toString(),f=this._requestService.getRequestUrl("root",n.empty,!0),g=this._requestService.getRequestUrl("root",p.scope,!0),v=/^['"]/.test(u.wordUntilPosition)?u.wordUntilPosition[0]:'"',b={currentWord:u.wordUntilPosition,suggestions:[]},y=Object.create(null);return d.contentResolver().accept(function(t){if(u.external&&n.endsWith(t.path,".d.ts"))return!0;var o=r.join(f,t.path);if(o===e.toString()||!r.isEqualOrParent(o,g))return!0;if(y[o])return!0;var i=h.makeModulePath(u.external,o,m);return y[o]={label:n.format("{0}{1}{0}",v,i),codeSnippet:n.rtrim(n.format("{0}{1}{0}",v,i),u.wordAfterPosition),documentationLabel:"."!==r.dirname(t.path)?n.format("{0} - {1}",r.basename(t.path),r.dirname(t.path)):t.path,type:"reference"},!0}).then(function(){return b.suggestions=o.values(y),b})},e.prototype._findCurrentWord=function(t,n,r){var o=this._resourceServices.get(t),i=o.getOffsetFromPosition(n),s=a.findTokenOnLeftOfPosition(r,i),l=o.getLineContent(n.lineNumber),c=e._TrippleSlashReference.exec(l);if(c){var u=o.getOffsetFromPosition({lineNumber:n.lineNumber,column:1});return{wordUntilPosition:c[2].substring(0,i-(u+c[1].length)),wordAfterPosition:c[2].substring(i-(u+c[1].length)),external:!1}}if(d.isTokenPath(s,a.SyntaxKind.StringLiteral,a.SyntaxKind.ExternalModuleReference))return{wordUntilPosition:a.getTextOfNode(s).substr(0,i-s.getStart()),wordAfterPosition:a.getTextOfNode(s).substr(i-s.getStart()),external:!0};if(d.isTokenPath(s,a.SyntaxKind.StringLiteral,a.SyntaxKind.ArrayLiteralExpression,a.SyntaxKind.CallExpression)){var p=d.parent(s,2);if("require"===a.getTextOfNode(p.expression))return{wordUntilPosition:a.getTextOfNode(s).substr(0,i-s.getStart()),wordAfterPosition:a.getTextOfNode(s).substr(i-s.getStart()),external:!0}}else if(d.isTokenPath(s,a.SyntaxKind.StringLiteral,a.SyntaxKind.ArrayLiteralExpression,a.SyntaxKind.CallExpression)){var p=d.parent(s,2);if("define"===a.getTextOfNode(p.expression))return{wordUntilPosition:a.getTextOfNode(s).substr(0,i-s.getStart()),wordAfterPosition:a.getTextOfNode(s).substr(i-s.getStart()),external:!0}}},e._TrippleSlashReference=/^(\/\/\/\s*<reference\s+path=)([^\s>]+)/i,e}();t.FilenameSuggestions=u;var d;!function(e){function t(e,t){for(;t-->0&&e;)e=e.parent;return e}function n(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];for(;t.length>0&&e;){var r=t.shift();if(r!==e.kind)return!1;e=e.parent}return!0}e.parent=t,e.isTokenPath=n}(d||(d={}))});