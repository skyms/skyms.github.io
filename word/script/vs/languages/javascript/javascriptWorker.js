/*---------------------------------------------------------
 * Copyright (C) Microsoft Corporation. All rights reserved.
 *--------------------------------------------------------*/
"use strict";var __extends=this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);r.prototype=t.prototype,e.prototype=new r};define("vs/languages/typescript/js/textEdits",["require","exports","vs/base/arrays","vs/base/strings","vs/base/collections"],function(e,t,r,n,o){function s(e,r){return-t.compareDecending(e,r)}function i(e,t){return e.offset===t.offset?t.length-e.length:t.offset-e.offset}function a(e){var t={};r.forEach(e,function(e,r){if(e.isInsert()){var n=o.lookupOrInsert(t,e.offset,e);n!==e&&(n.text+=e.text,r())}})}function l(e,r){var o,s=[],i=r.length,l=[],c=[];a(e),e.sort(t.compareDecending);for(var u=0,h=e.length;h>u;u++)o=e[u],s.push(r.substring(o.end,i)),s.push(o.text),i=o.offset,l.push(o.deltaLength),c.push(new d(o.offset,o.text.length,r.substr(o.offset,o.length)));s.push(r.substring(0,i));for(var p=0,u=c.length-1;u>=0;u--)c[u].offset+=p,p+=l[u];return{value:s.reverse().join(n.empty),doEdits:e,undoEdits:c}}function c(e,r,n){"undefined"==typeof n&&(n=0),e.sort(t.compareAscending);for(var o,s=0,i=0,a=e.length;a>i;i++)if(o=e[i],o.end<r)s+=o.deltaLength;else{if(o.offset>r)break;o.offset<=r&&o.end>=r&&(0===n?s+=Math.min(0,o.offset+(o.length+o.deltaLength)-r):1===n?s+=o.offset-r:2===n&&(s+=o.end+o.deltaLength-r))}return r+s}var u=function(){function e(e,t){this.offset=e,this.length=t}return e.from=function(t){return new e(t.offset,t.length)},Object.defineProperty(e.prototype,"end",{get:function(){return this.offset+this.length},enumerable:!0,configurable:!0}),e.prototype.equals=function(e){return this.offset===e.offset&&this.length===e.length},e.prototype.before=function(e){return this.end<=e.offset},e.prototype.after=function(t){return new e(t.offset,t.length).before(this)},e.prototype.contains=function(e){return e.offset>=this.offset&&e.offset<this.end&&e.offset+e.length<=this.end},e.prototype.overlaps=function(t){var r=new e(t.offset,t.length);return this.offset<r.offset&&this.end>=r.offset&&this.end<=r.end||r.offset<this.offset&&r.end>=this.offset&&r.end<=this.end},e}();t.TextSpan=u;var d=function(e){function t(t,r,n){e.call(this,t,r),this.text=n}return __extends(t,e),Object.defineProperty(t.prototype,"deltaLength",{get:function(){return this.text.length-this.length},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"deltaEnd",{get:function(){return this.end+this.deltaLength},enumerable:!0,configurable:!0}),t.prototype.isInsert=function(){return 0===this.length&&this.text.length>0},t.prototype.isReplace=function(){return this.length>0&&this.text.length>0},t.prototype.isDelete=function(){return this.length>0&&0===this.text.length},t.prototype.equals=function(t){return this.text===t.text&&e.prototype.equals.call(this,t)},t.prototype.toString=function(){return n.format("{0}-{1}/{2}",this.offset,this.length,this.text)},t}(u);t.Edit=d,t.compareAscending=s,t.compareDecending=i,t.apply=l,function(e){e[e.None=0]="None",e[e.StickLeft=1]="StickLeft",e[e.StickRight=2]="StickRight"}(t.TranslationBehaviour||(t.TranslationBehaviour={}));t.TranslationBehaviour;t.translate=c}),define("vs/languages/typescript/js/javaScriptRewriter",["require","exports","vs/base/strings","vs/languages/typescript/lib/typescriptServices","vs/languages/typescript/js/textEdits"],function(e,t,r,n,o){function s(e,t,r){t||(t=n.Parser.parse("fakefilename.ts",n.TextFactory.createText(r),!1,new n.ParseOptions(1,!0)));for(var s=new l(t),i=0,a=e.length;a>i;i++)e[i].computeEdits(s);return 0===s.edits.length?{value:r,doEdits:[],undoEdits:[]}:o.apply(s.edits,r)}function i(e){return"function"==typeof e.computeEdits&&1===e.computeEdits.length}var a=function(){function e(){}return e.prototype.to=function(e){return e},e.prototype.from=function(e){return e},Object.defineProperty(e.prototype,"report",{get:function(){return{isInserted:function(){return!1}}},enumerable:!0,configurable:!0}),e.Instance=new e,e}();t.IdentityTranslator=a,t.translate=s;var l=function(){function e(e){this.syntaxTree=e,this.syntaxInfo=n.SyntaxInformationMap.create(e.sourceUnit(),!0,!1),this._sourceUnitStart=this.syntaxInfo.start(e.sourceUnit()),this.edits=[]}return e.prototype.newInsert=function(e,t){var r;"string"==typeof e?(r=this._sourceUnitStart,t=e):r=e,this.edits.push(new o.Edit(r,0,t))},e.prototype.newDelete=function(e,t){this.edits.push(new o.Edit(e,t,r.empty))},e.prototype.newReplace=function(e,t,r){this.edits.push(new o.Edit(e,t,r))},e.prototype.newAppend=function(e){this.edits.push(new o.Edit(this.syntaxTree.sourceUnit().fullWidth(),0,e))},e}();t.AnalyzerContext=l,t.isISyntaxRewriter=i});var __extends=this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);r.prototype=t.prototype,e.prototype=new r};define("vs/languages/javascript/project/languageServiceHosts",["require","exports","vs/base/strings","vs/editor/core/position","vs/languages/typescript/features/converter","vs/languages/typescript/lib/typescriptServices","vs/languages/typescript/js/javaScriptRewriter","vs/languages/typescript/js/textEdits"],function(e,t,r,n,o,s,i,a){var l=function(){function e(e){this._delegate=e}return e.prototype.dispose=function(){this._delegate.dispose()},e.prototype.getStateId=function(){return this._delegate.getStateId()},e.prototype.addScriptSnapshot=function(e,t){return this._delegate.addScriptSnapshot(e,t)},e.prototype.removeScriptSnapshot=function(e){return this._delegate.removeScriptSnapshot(e)},e.prototype.getCompilationSettings=function(){return this._delegate.getCompilationSettings()},e.prototype.getScriptFileNames=function(){return this._delegate.getScriptFileNames()},e.prototype.getScriptVersion=function(e){return this._delegate.getScriptVersion(e)},e.prototype.getScriptIsOpen=function(e){return this._delegate.getScriptIsOpen(e)},e.prototype.getScriptByteOrderMark=function(e){return this._delegate.getScriptByteOrderMark(e)},e.prototype.getScriptSnapshot=function(e){return this._delegate.getScriptSnapshot(e)},e.prototype.getDiagnosticsObject=function(){return this._delegate.getDiagnosticsObject()},e.prototype.getLocalizedDiagnosticMessages=function(){return this._delegate.getLocalizedDiagnosticMessages()},e.prototype.resolveRelativePath=function(e,t){return this._delegate.resolveRelativePath(e,t)},e.prototype.fileExists=function(e){return this._delegate.fileExists(e)},e.prototype.directoryExists=function(e){return this._delegate.directoryExists(e)},e.prototype.getParentDirectory=function(e){return this._delegate.getParentDirectory(e)},e.prototype.information=function(){return this._delegate.information()},e.prototype.debug=function(){return this._delegate.debug()},e.prototype.warning=function(){return this._delegate.warning()},e.prototype.error=function(){return this._delegate.error()},e.prototype.fatal=function(){return this._delegate.fatal()},e.prototype.log=function(e){this._delegate.log(e)},e}();t.DelegateLanguageServiceHost=l;var c=function(){function e(e,t,r){this._textOperationResult=e,this._lineMapModified=s.LineMap1.fromScriptSnapshot(t),this._lineMapOriginal=s.LineMap1.fromScriptSnapshot(r)}return e.prototype.to=function(e){if(n.isIPosition(e))return this._doTranslate(this._textOperationResult.doEdits,this._lineMapOriginal,this._lineMapModified,e,0);var t=e,r=this._doTranslate(this._textOperationResult.doEdits,this._lineMapOriginal,this._lineMapModified,{lineNumber:t.startLineNumber,column:t.startColumn},0),o=this._doTranslate(this._textOperationResult.doEdits,this._lineMapOriginal,this._lineMapModified,{lineNumber:t.endLineNumber,column:t.endColumn},0);return{startLineNumber:r.lineNumber,startColumn:r.column,endLineNumber:o.lineNumber,endColumn:o.column}},e.prototype.from=function(e){if(n.isIPosition(e))return this._doTranslate(this._textOperationResult.undoEdits,this._lineMapModified,this._lineMapOriginal,e,0);var t=e,r=this._doTranslate(this._textOperationResult.undoEdits,this._lineMapModified,this._lineMapOriginal,{lineNumber:t.startLineNumber,column:t.startColumn},1),o=this._doTranslate(this._textOperationResult.undoEdits,this._lineMapModified,this._lineMapOriginal,{lineNumber:t.endLineNumber,column:t.endColumn},2);return{startLineNumber:r.lineNumber,startColumn:r.column,endLineNumber:o.lineNumber,endColumn:o.column}},e.prototype._doTranslate=function(e,t,r,n,s){var i=o.getOffset(t,n),l=a.translate(e,i,s);return o.getPosition(r,l)},Object.defineProperty(e.prototype,"report",{get:function(){return this},enumerable:!0,configurable:!0}),e.prototype.isInserted=function(e){var t;t=n.isIPosition(e)?n.PositionUtils.asEmptyRange(e):e;for(var r=o.getStartOffset(this._lineMapModified,t),s=o.getEndOffset(this._lineMapModified,t),i=this._textOperationResult.undoEdits,l=0,c=i.length;c>l;l++)if(i[l].contains(new a.TextSpan(r,s-r)))return!0;return!1},e}(),u=function(){function e(e){this._value=e,this._lineStarts=s.TextUtilities.parseLineStarts(e)}return e.prototype.getText=function(e,t){return this._value.substring(e,t)},e.prototype.getLength=function(){return this._value.length},e.prototype.getLineStartPositions=function(){return this._lineStarts},e.prototype.getTextChangeRangeSinceVersion=function(){return null},e}(),d=function(e){function t(t,r){e.call(this,t),this._rewriter=r,this._rewrittenSnapshots=Object.create(null)}return __extends(t,e),t.prototype.dispose=function(){},t.prototype.getScriptSnapshot=function(t){var r=this._getOrCreateRewrittenSnapshot(t);return r?r.snapshot:e.prototype.getScriptSnapshot.call(this,t)},t.prototype.getTranslator=function(e){var t=this._getOrCreateRewrittenSnapshot(e);return t?t.translator:null},t.prototype._getOrCreateRewrittenSnapshot=function(t){if(!r.endsWith(t,".js"))return null;if(!this.fileExists(t))return null;var n=this.getScriptVersion(t),o=this._rewrittenSnapshots[t];if(!o||o.versionId!==n){var s=e.prototype.getScriptSnapshot.call(this,t),a=i.translate(this._rewriter,null,s.getText(0,s.getLength())),l=new u(a.value);o={versionId:this.getScriptVersion(t),snapshot:l,translator:new c(a,l,s)},this._rewrittenSnapshots[t]=o}return o},t}(l);t.RewritingLanguageServiceHost=d});var __extends=this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);r.prototype=t.prototype,e.prototype=new r};define("vs/languages/javascript/project/javascriptProject",["require","exports","vs/languages/typescript/lib/typescriptServices","vs/languages/javascript/project/languageServiceHosts","vs/languages/typescript/project/typescriptProject","vs/languages/typescript/js/javaScriptRewriter"],function(e,t,r,n,o,s){var i=function(e){function t(t,r,n,o,s,i,a,l){e.call(this,t,n,o,s,i,a,l),this._rewriter=r}return __extends(t,e),t.prototype.semanticLanguageService=function(){if(!this._semanticLanguageService){var t=e.prototype.semanticLanguageService.call(this),o=new n.RewritingLanguageServiceHost(t.host,this._rewriter);this._disposables.push(o),this._applyCompileConfig(o.getCompilationSettings()),this._semanticLanguageService=new r.Services.LanguageService(o)}return this._semanticLanguageService},t.prototype.getTranslater=function(e){var t=this.semanticLanguageService().host;return t.getTranslator(e.toExternal())||s.IdentityTranslator.Instance},t}(o.TypeScriptProject);t.JavascriptProject=i});var __extends=this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);r.prototype=t.prototype,e.prototype=new r};define("vs/languages/javascript/javascriptWorker",["require","exports","vs/base/strings","vs/base/arrays","vs/editor/modes/modesFilters","vs/editor/core/model/mirrorModel","vs/languages/typescript/typescriptWorker2","vs/languages/typescript/typescript.configuration","vs/languages/javascript/javascript.configuration","vs/languages/typescript/js/javaScriptRewriter","vs/languages/javascript/project/javascriptProject","vs/languages/typescript/features/validationStrategy"],function(e,t,r,n,o,s,i,a,l,c,u,d){var h=function(e){function t(t,r,n){e.call(this,t,r,n)}return __extends(t,e),t.prototype._doConfigure=function(t){for(var r=a.sanitize(t,l._internalDefaultValidationSettings,l.defaultSuggestSettions),n=0,o=r.validationSettings.length;o>n;n++){var s=new l.JavaScriptDiagnosticsClassifier(r.validationSettings[n].lint);r.validationSettings[n].diagnosticClassifier=s.classify.bind(s)}return e.prototype._doConfigure.call(this,r)},t.prototype._isMirrorModelAndMyMode=function(t){var n=e.prototype._isMirrorModelAndMyMode.call(this,t);if(n)return!0;if(!(t instanceof s.AbstractMirrorModel))return!1;var o=t,i=o.getModeId();if("vs.languages.typescript"!==i)return!1;var a=o.getAssociatedResource().getPath();return r.endsWith(a,"_references.ts")||r.endsWith(a,".d.ts")?!0:!1},t.prototype._createProject=function(e,t,r,n,o){return this._instantiationService.createInstance(u.JavascriptProject,this._getWorkerParticipants(function(e){return c.isISyntaxRewriter(e)}),this._getMode(),e,r,t,n,o)},t.prototype.translator=function(e){var t=this.findProject(e);return t.getTranslater(e)},t.prototype._isRelevantForValidationPurposes=function(e){return r.endsWith(e.toExternal(),".d.ts")||r.endsWith(e.toExternal(),"_references.ts")},t.prototype._shouldValidate=function(e){return!this._isRelevantForValidationPurposes(e)},t.prototype.doValidateOnChange=function(t,r,n){var o=this._shouldValidate.bind(this);e.prototype.doValidateOnChange.call(this,t.filter(o),r.filter(o),n)},t.prototype._shouldIncludeModelInValidation=function(t){if(!(t instanceof s.MirrorModel||t instanceof s.MirrorModelEmbedded))return!1;if(e.prototype._shouldIncludeModelInValidation.call(this,t))return!0;var r=t;return this._isRelevantForValidationPurposes(r.getAssociatedResource())},t.prototype._publishMarkersForResource=function(t,r,o){if(r!==d.ValidationType.Syntax){var s=this.translator(t);n.forEach(o,function(e,t){var r={startLineNumber:e.startLineNumber,startColumn:e.startColumn,endLineNumber:e.endLineNumber,endColumn:e.endColumn};s.report.isInserted(r)?t():(r=s.from(r),e.startLineNumber=r.startLineNumber,e.startColumn=r.startColumn,e.endLineNumber=r.endLineNumber,e.endColumn=r.endColumn)})}return e.prototype._publishMarkersForResource.call(this,t,r,o)},t.prototype.doSuggest=function(t,r){return e.prototype.doSuggest.call(this,t,this.translator(t).to(r))},t.prototype.getSuggestionFilter=function(){return o.and(function(e,t){return t.label.indexOf("̲")<0},e.prototype.getSuggestionFilter.call(this))},t.prototype.getSuggestionDetails=function(t,r,n){return e.prototype.getSuggestionDetails.call(this,t,this.translator(t).to(r),n)},t.prototype.getParameterHints=function(t,r){return e.prototype.getParameterHints.call(this,t,this.translator(t).to(r))},t.prototype.findOccurrences=function(t,r,o){var s=this;return e.prototype.findOccurrences.call(this,t,this.translator(t).to(r),o).then(function(e){return n.forEach(e,function(e,r){s.translator(t).report.isInserted(e.range)?r():e.range=s.translator(t).from(e.range)}),e})},t.prototype._findTypeScriptDeclaration=function(t,r){var n=this;return e.prototype._findTypeScriptDeclaration.call(this,t,this.translator(t).to(r)).then(function(e){if(e){var t=n.translator(e.resourceUrl);if(!t.report.isInserted(e.range))return e.range=t.from(e.range),e}return null})},t.prototype.findReferences=function(t,r,o){var s=this;return e.prototype.findReferences.call(this,t,this.translator(t).to(r),o).then(function(e){return n.forEach(e,function(e,t){var r=s.translator(e.resourceUrl);r.report.isInserted(e.range)?t():e.range=r.from(e.range)}),e})},t.prototype.computeInfo=function(t,r){var n=this;return e.prototype.computeInfo.call(this,t,this.translator(t).to(r)).then(function(e){return e&&(e.range=n.translator(t).from(e.range)),e})},t}(i.TypeScriptWorker2);t.JavaScriptWorker=h});